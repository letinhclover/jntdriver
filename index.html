<!DOCTYPE html>
<html lang="vi">
<head>
<!-- 1. X√ÅC MINH & C·∫§U H√åNH -->
<meta name="google-site-verification" content="dE9NgLvppbsz9DsFv3CwhHBR8KNF9hiM5CDQ2Houyvc" />
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Link T√†i X·∫ø J&T Express</title>

<!-- 2. PWA & ICONS -->
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff0033">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="application-name" content="Link T√†i X·∫ø J&T">

<!-- 3. FONTS & SEO -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<meta name="description" content="Link t√†i x·∫ø J&T Express: T·ªïng h·ª£p Link n·ªôi b·ªô, Nh√≥m Zalo, T√≠nh l∆∞∆°ng, D·∫ßu, Map kho. T·∫•t c·∫£ trong m·ªôt.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://letinhclover.github.io/jntdriver">

<style>
/* CSS GIAO DI·ªÜN */
:root {
  --bg-light: #f8fafc; --bg-dark: #111214;
  --text-light: #0b0b0b; --text-dark: #f5f5f5;
  --primary: #CC0000; --accent: #198845;
  --card: #ffffff; --card-dark: #1d1f21;
  --highlight-bg: #fff3f2;
  --edit: #f39c12;
  --blue-text: #007bff; 
  --red-text: #d32f2f;
}
*, *::before, *::after { box-sizing: border-box; }

body {
  font-family: 'Roboto', sans-serif;
  margin: 0; background: var(--bg-light); color: var(--text-light);
  transition: background .25s, color .25s;
  -webkit-tap-highlight-color: transparent; font-size: 15px; line-height: 1.4;
}
body.dark { background: var(--bg-dark); color: var(--text-dark); }

header {
  background: linear-gradient(90deg, var(--primary), #dd2476);
  color: #fff; padding: 14px 16px; text-align: center;
  position: relative; font-weight: 800; font-size: 1.2em;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
#toggleTheme {
  position: absolute; right: 12px; top: 10px;
  background: none; border: none; color: #fff;
  font-size: 18px; cursor: pointer; padding: 5px;
}

.container { max-width: 720px; margin: 10px auto; padding: 10px; }

/* GROUP STYLES */
.group {
  margin-bottom: 14px; border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
  background: var(--card);
}
body.dark .group { box-shadow: 0 2px 6px rgba(0,0,0,.3); background: var(--card-dark); }

.group-header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 14px; cursor: pointer; font-weight: 700;
  background: rgba(0,0,0,0.02); border-radius: 10px 10px 0 0; user-select: none;
}
.group-header span.title { color: var(--primary); }
.group-header .arrow { transition: transform .25s; }
.group.open .group-header .arrow { transform: rotate(90deg); }
.group-content { display: none; padding-bottom: 5px; animation: fadeIn 0.2s ease; }
.group.open .group-content { display: block; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* LINK CARDS */
a.link-card {
  display: flex; justify-content: space-between; align-items: center;
  text-decoration: none; color: inherit;
  padding: 10px; border-radius: 8px; margin: 6px 10px;
  background: rgba(0,0,0,0.03); transition: transform .1s;
}
a.link-card:active { transform: scale(0.98); background: rgba(0,0,0,0.08); }
body.dark a.link-card { background: rgba(255,255,255,0.05); }

/* CONTACT GRID */
.contact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px 12px; }
a.contact-btn {
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  padding: 8px 5px; border-radius: 8px;
  background: rgba(0,0,0,0.03); color: var(--text-light);
  text-decoration: none; height: 60px; text-align: center;
}
body.dark a.contact-btn { background: rgba(255,255,255,0.05); color: var(--text-dark); }
.contact-btn .name-contact { font-weight: 700; font-size: 0.95em; }
.contact-btn .role-contact { font-size: 0.75em; opacity: 0.7; margin-top: 2px; }

.contact-note {
    text-align: center; margin-bottom: 10px;
    font-size: 0.9em; font-style: italic; opacity: 0.8;
    color: var(--text-light);
}
body.dark .contact-note { color: var(--text-dark); }

/* INPUTS & BUTTONS */
.calc-content { padding: 14px; display: flex; flex-direction: column; align-items: center; gap: 12px; }
.input-group-calc { width: 94%; max-width: 580px; }
.calc-label { display: block; margin-top: 8px; font-weight: 600; font-size: 15px; }
.calc-input {
  width: 100%; padding: 12px; margin-top: 4px;
  border: 1px solid #ccc; border-radius: 8px; font-size: 16px;
  background: var(--bg-light); color: var(--text-light);
}
body.dark .calc-input { border-color: #555; background: #2b2b2b; color: var(--text-dark); }

button.calc-submit {
  width: 92%; max-width: 600px; padding: 12px;
  border-radius: 10px; font-size: 16px; font-weight: 700;
  margin-top: 15px;
  border: none; background: var(--primary); color: #fff; cursor: pointer;
}
button.calc-submit:active { opacity: .9; transform: translateY(1px); }
button.btn-update { background: var(--edit) !important; }

/* LAYOUT 3 C·ªòT CHO L∆Ø∆†NG */
.salary-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; width: 94%; max-width: 580px; }
.salary-col { display: flex; flex-direction: column; }
.salary-col .calc-label { font-size: 13px; margin-top: 0; margin-bottom: 2px; text-align: center; }
.salary-col .calc-input { text-align: center; padding: 10px 4px; font-weight: 500; }

/* RESULT BOXES */
.result-box, .result-box-ot {
  width: 92%; max-width: 600px; margin-top: 10px; padding: 12px;
  border-radius: 10px; font-size: 15px; line-height: 1.5;
}
.result-box { background: rgba(0,0,0,0.05); }
body.dark .result-box { background: rgba(255,255,255,0.05); color: var(--text-dark); }
.result-box-ot { background-color: var(--highlight-bg); border: 1px solid var(--primary); }
body.dark .result-box-ot { background-color: #312121; border: 1px solid rgba(255,255,255,0.1); }

.result-box-ot h3 { color: var(--primary); font-size: 1.1em; margin: 0 0 8px 0; border-bottom: 1px dashed #ccc; padding-bottom: 5px; text-align: center; }

/* GRID K·∫æT QU·∫¢ L∆Ø∆†NG */
.result-grid-row {
    display: grid;
    grid-template-columns: 45% 15% 40%; 
    align-items: center;
    margin: 10px 0;
    border-bottom: 1px dashed rgba(0,0,0,0.1);
    padding-bottom: 6px;
}
body.dark .result-grid-row { border-color: rgba(255,255,255,0.1); }

.grid-label { font-weight: 700; text-align: left; font-size: 1.0em; }
.grid-hours { font-weight: 700; text-align: center; font-size: 1.1em; } 
.grid-money { font-weight: 700; text-align: right; font-size: 1.1em; }

/* M√ÄU S·∫ÆC TƒÇNG CA */
.text-blue { color: var(--blue-text); }
body.dark .text-blue { color: #4da3ff; }
.text-red { color: var(--red-text); }
body.dark .text-red { color: #ff6659; }

.result-item { display: flex; justify-content: space-between; margin: 6px 0; }
.result-item-total { font-size: 1.05em; font-weight: 700; border-top: 2px solid #ff9788; padding-top: 8px; margin-top: 8px; color: var(--primary); display: flex; justify-content: space-between; align-items: center; }
.ot-note { font-size: 0.85em; font-style: italic; opacity: 0.8; margin-top: 10px; border-top: 1px solid #ddd; padding-top: 5px; text-align: center; }

/* LOGBOOK STYLE */
.odo-setup {
    background: rgba(0,0,0,0.03); padding: 10px; 
    border-radius: 8px; border: 1px solid var(--accent);
    margin-bottom: 10px; width: 100%;
}
body.dark .odo-setup { background: rgba(25, 136, 69, 0.1); }

.log-input-container {
    width: 100%; background: rgba(0,0,0,0.02);
    padding: 8px; border-radius: 8px; border: 1px solid #eee;
}
body.dark .log-input-container { background: rgba(255,255,255,0.05); border-color: #333; }

.log-row-1 { width: 100%; margin-bottom: 8px; } 
.log-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; } 

.log-input { padding: 12px; border: 1px solid #ccc; border-radius: 5px; width: 100%; font-size: 15px; }
body.dark .log-input { background: #2b2b2b; border-color: #555; color: #fff; }
.log-select { padding: 12px; border: 1px solid #ccc; border-radius: 5px; width: 100%; font-size: 15px; background: #fff; }
body.dark .log-select { background: #2b2b2b; color: #fff; border-color: #555; }

.log-list { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
.log-list th { background: rgba(0,0,0,0.05); padding: 8px 4px; text-align: left; font-size: 12px; color: var(--primary); }
body.dark .log-list th { background: rgba(255,255,255,0.1); }
.log-list td { border-bottom: 1px solid rgba(0,0,0,0.1); padding: 10px 4px; vertical-align: middle; }
body.dark .log-list td { border-bottom: 1px solid rgba(255,255,255,0.3); } 

.log-action-btn { font-size: 16px; border: none; background: none; cursor: pointer; margin-left: 8px; }
.btn-edit { color: var(--edit); }
.btn-del { color: #999; }

.log-summary {
    background: var(--highlight-bg); border: 1px dashed var(--primary);
    border-radius: 8px; padding: 10px; margin-top: 15px; width: 100%;
    font-size: 14px;
}
body.dark .log-summary { background: #312121; border-color: rgba(255,255,255,0.2); }
.log-summary div { margin-bottom: 4px; display: flex; justify-content: space-between; }

/* NOTEBOOK STYLE */
.note-area {
  width: 96%; height: 120px; padding: 10px;
  border: 1px solid #ccc; border-radius: 8px;
  font-family: inherit; margin: 10px auto; display: block;
  background: var(--bg-light); color: var(--text-light); font-size: 16px;
}
body.dark .note-area { background: #2b2b2b; color: var(--text-dark); border-color: #555; }
.save-btn { background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }

/* SECTION DIVIDER */
.section-title {
    padding: 10px 10px 5px 10px; font-weight: bold; color: var(--primary); 
    border-bottom: 1px solid rgba(0,0,0,0.1); margin: 15px 10px 5px 10px;
    font-size: 0.95em; text-transform: uppercase;
}
body.dark .section-title { border-color: rgba(255,255,255,0.1); }

/* QR SHARE */
.qr-container { text-align: center; padding: 10px; margin-top:10px;}
.qr-img { 
    width: 160px; height: 160px; 
    mix-blend-mode: multiply;
    margin-bottom: 10px;
    background-color: #fff; border: 5px solid #fff; border-radius: 8px;
}
body.dark .qr-img { mix-blend-mode: normal; border: 4px solid #fff; }

.share-btn-native {
    background: #007bff; color: white; border: none;
    padding: 12px 25px; border-radius: 30px;
    font-weight: bold; cursor: pointer;
    font-size: 16px; display: inline-flex; align-items: center; gap: 8px;
    box-shadow: 0 4px 10px rgba(0,123,255,0.3);
    transition: transform 0.1s;
}
.share-btn-native:active { transform: scale(0.95); }

/* INTRO */
.intro-box {
    padding: 15px; margin: 10px 5px;
    font-size: 0.95em; color: #444; line-height: 1.6; text-align: justify;
    background: rgba(0,0,0,0.02); border-radius: 8px; border-left: 3px solid #ccc;
}
body.dark .intro-box { color: #ccc; background: rgba(255,255,255,0.05); }

.author-box {
    text-align: center; font-size: 0.9em; color: var(--text-light); margin-top: 20px; border-top:1px dashed #ccc; padding-top:15px;
}
body.dark .author-box { color: var(--text-dark); }

footer { padding: 15px; text-align: center; background: var(--card); border-top: 1px solid rgba(0,0,0,.04); margin-top: 20px; }
body.dark footer { background: var(--card-dark); }
.footer-text { font-weight: bold; color: var(--primary); font-size: 0.9em; }
.footer-link { color: var(--accent); font-weight: 700; text-decoration: none; }
</style>
</head>
<body>

<header>
  LINK T√ÄI X·∫æ J&T
  <button id="toggleTheme" aria-label="chuy·ªÉn s√°ng t·ªëi">üåô</button>
</header>

<main class="container">
  
  <!-- 1. C√îNG VI·ªÜC -->
  <div class="group">
    <div class="group-header" role="button" tabindex="0">
      <span class="title">üìã C√¥ng vi·ªác n·ªôi b·ªô</span><span class="arrow">‚ñ∂</span>
    </div>
    <div class="group-content">
      <a class="link-card" href="https://jntexpress.vn/attendance" target="_blank"><div class="link-left">CH·∫§M C√îNG CRM</div></a>
      <a class="link-card" href="https://jtexpress.sg.feishu.cn/share/base/form/shrlgwao5eoTslB2Ds1auT05WPg" target="_blank"><div class="link-left">B√ÅO C√ÅO H√ÄNH TR√åNH</div></a>
      <a class="link-card" href="https://jtexpress.sg.feishu.cn/share/base/form/shrlgwwFr50osovPX8c5EuYkpVe" target="_blank"><div class="link-left">ƒêI·ªÄN TH√îNG TIN TƒÇNG CA</div></a>
      <a class="link-card" href="https://jtexpress.sg.feishu.cn/share/base/form/shrlgeJOb7CxaLL18zxNj6gz1kd" target="_blank"><div class="link-left">ƒêƒÇNG K√ç NGH·ªà PH√âP</div></a>
      <a class="link-card" href="https://jtexpress.sg.feishu.cn/share/base/form/shrlgcx3ZWJlUeZ007y7NOMDtAf" target="_blank"><div class="link-left">KI·ªÇM TRA XE H·∫∞NG NG√ÄY</div></a>
      <a class="link-card" href="https://jtexpress.sg.feishu.cn/share/base/form/shrlg4jTyiyUBTxoWnXnh3E2jVh" target="_blank"><div class="link-left">KH√îNG B·∫§M APP ƒê∆Ø·ª¢C</div></a>
      <a class="link-card" href="https://jtexpress.sg.feishu.cn/share/base/form/shrlglpEg10qLFAoBoN6FYGm0Nv" target="_blank"><div class="link-left">G·ª¨I H√åNH V√Å V·ªé</div></a>
      <a class="link-card" href="https://jtexpress.sg.feishu.cn/share/base/form/shrlgj3VYEKTEh7tTSaZvfpP7HL" target="_blank"><div class="link-left">B√ÅO C√ÅO TH√ôNG XE TR·ªêNG</div></a>
      <a class="link-card" href="https://jtexpress.sg.feishu.cn/share/base/form/shrlgHKbeP4ff2P8AoaQcWUzicc" target="_blank"><div class="link-left">TH√îNG TIN ƒê·ªî D·∫¶U</div></a>
    </div>
  </div>

  <!-- 2. ZALO -->
  <div class="group">
    <div class="group-header" role="button" tabindex="0">
      <span class="title">üí¨ Group Zalo</span><span class="arrow">‚ñ∂</span>
    </div>
    <div class="group-content">
      <a class="link-card" href="https://zalo.me/g/uolmnc539" target="_blank"><div class="link-left">Nh√≥m b√°o c√°o n·ªôi th√†nh</div></a>
      <a class="link-card" href="https://zalo.me/g/plhjmt899" target="_blank"><div class="link-left">Nh√≥m b·∫•t th∆∞·ªùng n·ªôi th√†nh</div></a>
      <a class="link-card" href="https://zalo.me/g/byikns239" target="_blank"><div class="link-left">Nh√≥m th√¥ng b√°o t√†i x·∫ø J&T</div></a>
      <a class="link-card" href="https://zalo.me/g/xuizfi412" target="_blank"><div class="link-left">Nh√≥m b√°o c√°o ƒë·ªï d·∫ßu tuy·∫øn nh√°nh</div></a>
    </div>
  </div>

  <!-- 3. LI√äN H·ªÜ -->
  <div class="group">
    <div class="group-header" role="button" tabindex="0">
      <span class="title">üìû Li√™n h·ªá h·ªó tr·ª£</span><span class="arrow">‚ñ∂</span>
    </div>
    <div class="group-content">
        <div class="contact-note">‚ö†Ô∏è ∆Øu ti√™n nh·∫Øn Zalo & li√™n h·ªá trong gi·ªù l√†m vi·ªác.</div>
        <div class="contact-grid">
            <div style="grid-column: 1/3; font-weight: 700; color: var(--primary); padding-top: 5px;">ƒê·ªòI TR∆Ø·ªûNG</div>
            <a href="tel:0973235381" class="contact-btn" style="grid-column: 1/3;"><span class="name-contact">Giang Nguy·ªÖn</span><span class="role-contact">ƒê·ªôi tr∆∞·ªüng ƒë·ªôi xe</span></a>
            <a href="tel:0762244662" class="contact-btn"><span class="name-contact">Tr√≠ L√™</span><span class="role-contact">ƒê·ªôi tr∆∞·ªüng ca ng√†y</span></a>
            <a href="tel:090" class="contact-btn"><span class="name-contact">Ho√†ng Tr·∫ßn</SPAN><span class="role-contact">ƒê·ªôi tr∆∞·ªüng ca ƒë√™m</span></a>

            <div style="grid-column: 1/3; font-weight: 700; color: var(--primary); padding-top: 10px;">B·∫¢O TR√å XE</div>
            <a href="tel:090" class="contact-btn"><span class="name-contact">Ho√†ng Trung</span><span class="role-contact">B·∫£o tr√¨ Thaco, Isuzu</span></a>
            <a href="tel:0906722489" class="contact-btn"><span class="name-contact">Thanh Li√™m</span><span class="role-contact">B·∫£o tr√¨ Jac, Gaz</span></a>

            <div style="grid-column: 1/3; font-weight: 700; color: var(--primary); padding-top: 10px;">ƒêI·ªÄU PH·ªêI</div>
            <div style="grid-column: 1/3; text-align: center; font-size: 0.85em; font-weight: 600; background: rgba(25, 136, 69, 0.15); color: var(--accent); border-radius: 4px; padding: 4px 0;">CA S√ÅNG (7h - 17h30) üü¢</div>
            <a href="tel:0399007309" class="contact-btn" style="grid-column: 1/3;"><span class="name-contact">ƒê·∫∑ng Qu·ªëc Th√°i</span><span class="role-contact">ƒêi·ªÅu ph·ªëi VP</span></a>
            <a href="tel:0972251731" class="contact-btn"><span class="name-contact">Nguy·ªÖn Ti·∫øn Trung</span><span class="role-contact">TTTC (7h-16h)</span></a>
            <a href="tel:0869814645" class="contact-btn"><span class="name-contact">Nguy·ªÖn Th√†nh Vinh</span><span class="role-contact">Xe 5T-9T</span></a>

            <div style="grid-column: 1/3; text-align: center; font-size: 0.85em; font-weight: 600; background: rgba(255, 165, 0, 0.2); color: #CC6600; border-radius: 4px; padding: 4px 0; margin-top: 8px;">CA NG√ÄY (12h - 21h) üü†</div>
            <a href="tel:0962073793" class="contact-btn"><span class="name-contact">Ph·∫°m Minh K·ª≥</span><span class="role-contact">GW0 (12h-21h)</span></a>
            <a href="tel:0365762179" class="contact-btn"><span class="name-contact">Nguy·ªÖn T·∫•n T√†i</span><span class="role-contact">GW0 (12h-21h)</span></a>
            <a href="tel:0764341791" class="contact-btn" style="grid-column: 1/3;"><span class="name-contact">Nguy·ªÖn Ho√†ng Ph√∫c</span><span class="role-contact">GW0 (12h-21h)</span></a>

            <div style="grid-column: 1/3; text-align: center; font-size: 0.85em; font-weight: 600; background: rgba(204, 0, 0, 0.15); color: var(--primary); border-radius: 4px; padding: 4px 0; margin-top: 8px;">CA T·ªêI (18h - 4h) üî¥</div>
            <a href="tel:0886468035" class="contact-btn"><span class="name-contact">H·ªì S·ªπ L∆∞u</span><span class="role-contact">18h-3h</span></a>
            <a href="tel:0336492538" class="contact-btn"><span class="name-contact">Ho√†ng H·∫£i</span><span class="role-contact">GW3 (18h-3h)</span></a>
            <a href="tel:0326466205" class="contact-btn"><span class="name-contact">Trung H·∫≠u</span><span class="role-contact">GW4 (18h-3h)</span></a>
            <a href="tel:0372026225" class="contact-btn"><span class="name-contact">T·∫•n Sang</span><span class="role-contact">18h-3h</span></a>
            <a href="tel:0903969713" class="contact-btn"><span class="name-contact">Ph√∫c H·∫≠u</span><span class="role-contact">GW6 (18h-3h)</span></a>
            <a href="tel:0332277821" class="contact-btn"><span class="name-contact">Minh Quang</span><span class="role-contact">GW5 (19h-4h)</span></a>

            <div style="grid-column: 1/3; text-align: center; font-size: 0.85em; font-weight: 700; color: #007bff; border-top: 1px dashed #ccc; padding-top: 10px; margin-top: 10px;">B√åNH D∆Ø∆†NG - T√ÇY NINH üîµ</div>
             <a href="tel:0334457083" class="contact-btn"> <span class="name-contact">Qu·ªëc Anh</span><span class="role-contact">GW0 (21h-6h30)</span></a>
            <a href="tel:0962073741" class="contact-btn"> <span class="name-contact">H·ªì S·ªπ Ti·∫øn</span><span class="role-contact">GW0 (21h-6h)</span></a>
        </div>
    </div>
  </div>

  <!-- 4. MAPS -->
  <div class="group">
    <div class="group-header" role="button" tabindex="0">
      <span class="title">üìç ƒê·ªãa ch·ªâ Google Map</span><span class="arrow">‚ñ∂</span>
    </div>
    <div class="group-content" id="mapListContainer"></div>
  </div>

  <!-- 5. T√çNH D·∫¶U & NH·∫¨T K√ù -->
  <div class="group">
    <div class="group-header" role="button" tabindex="0">
      <span class="title">üõ¢ T√≠nh D·∫ßu & Nh·∫≠t K√Ω ODO</span><span class="arrow">‚ñ∂</span>
    </div>
    <div class="group-content">
      <div class="calc-content">
        
        <!-- NH·∫¨T K√ù -->
        <div class="section-title" style="margin-top:0">üìí NH·∫¨T K√ù ODO (GHI S·ªî)</div>
        
        <div class="odo-setup">
             <label class="calc-label" style="margin:0">üìå ODO Ch·ªët Th√°ng Tr∆∞·ªõc:</label>
             <div style="display:flex; gap:8px; margin-top:8px;">
                 <input type="number" id="closingOdo" class="calc-input" placeholder="VD: 22000" inputmode="numeric" onfocus="this.select()" min="0">
                 <button class="save-btn" onclick="saveClosingOdo()" style="width:90px">L∆∞u</button>
             </div>
             <div id="savedOdoText" style="font-size:14px; color:var(--accent); margin-top:5px; font-style:italic; font-weight:500"></div>
        </div>

        <div class="log-input-container">
             <div class="log-row-1">
                 <input type="date" id="logDate" class="log-input">
             </div>
             <div class="log-row-2">
                 <input type="number" id="logLiters" class="log-input" placeholder="S·ªë L√≠t" inputmode="decimal" onfocus="this.select()" min="0">
                 <input type="number" id="logOdo" class="log-input" placeholder="ODO Hi·ªán t·∫°i" inputmode="numeric" onfocus="this.select()" min="0">
             </div>
        </div>
        <button class="calc-submit" id="btnAddFuel" onclick="addFuelLog()">‚ûï Th√™m Nh·∫≠t K√Ω</button>
        <button class="calc-submit" id="btnCancelFuel" onclick="cancelFuelEdit()" style="background:#7f8c8d; display:none; margin-top:8px">H·ªßy S·ª≠a</button>

        <table class="log-list" id="fuelLogList"></table>

        <div class="log-summary">
            <div>ƒê√£ ch·∫°y: <span id="totalKm" class="result-value">0 km</span></div>
            <div>ƒê√£ ƒë·ªï: <span id="totalLiters" class="result-value">0 L√≠t</span></div>
            <div style="border-top:1px dashed #999; margin-top:8px; padding-top:8px; color:var(--primary); font-weight:700; text-align:center">
                Ti√™u hao trung b√¨nh: <span id="avgCons" style="font-size:1.2em">0</span> L√≠t/100km
            </div>
        </div>
        <button class="save-btn" style="background:#555; width:100%; margin-top:15px; padding:12px" onclick="resetFuelMonth()">üóëÔ∏è Qua th√°ng m·ªõi (X√≥a h·∫øt)</button>

        <!-- T√çNH NHANH -->
        <div class="section-title" style="margin-top:25px">‚ö° T√çNH NHANH (D·ª∞ T√çNH)</div>
        <div class="input-group-calc">
          <label class="calc-label">M·ª©c kho√°n (l√≠t/100 km):</label>
          <input type="text" id="khoan" placeholder="VD: 14" inputmode="decimal" class="calc-input" onfocus="this.select()" min="0">
        </div>
        <div class="input-group-calc">
          <label class="calc-label">Qu√£ng ƒë∆∞·ªùng ƒë√£ ƒëi (km) :</label>
          <input type="text" id="km" placeholder="VD: 1000" inputmode="decimal" class="calc-input" onfocus="this.select()" min="0">
        </div>
        <div class="input-group-calc">
          <label class="calc-label">L∆∞·ª£ng d·∫ßu th·ª±c t·∫ø (l√≠t):</label>
          <input type="text" id="thuc" placeholder="VD: 130" inputmode="decimal" class="calc-input" onfocus="this.select()" min="0">
        </div>
        <div class="input-group-calc">
          <label class="calc-label">Gi√° d·∫ßu (VND/l√≠t):</label>
          <input type="text" id="gia" placeholder="VD: 19.000" inputmode="numeric" class="calc-input" onfocus="this.select()" oninput="formatInputMoney(this)" min="0">
        </div>
        <button class="calc-submit" onclick="tinhDau()">T√çNH K·∫æT QU·∫¢</button>
        <div id="resultDau" class="result-box-ot" style="display:none;">
             <!-- K·∫æT QU·∫¢ D·∫¶U HI·ªÜN ·ªû ƒê√ÇY -->
        </div>
      </div>
    </div>
  </div>

  <!-- 6. T√çNH L∆Ø∆†NG & NH·∫¨T K√ù -->
  <div class="group">
    <div class="group-header" role="button" tabindex="0">
      <span class="title">üí∞ L∆∞∆°ng & Nh·∫≠t k√Ω tƒÉng ca</span><span class="arrow">‚ñ∂</span>
    </div>
    <div class="group-content">
      <div class="calc-content">
          <!-- C√ÄI ƒê·∫∂T L∆Ø∆†NG -->
          <div class="salary-row">
              <div class="salary-col">
                  <label class="calc-label">L∆∞∆°ng CB</label>
                  <input type="text" id="ot_luongCanBan" value="5.007.600" class="calc-input" inputmode="numeric" onfocus="this.select()" oninput="formatInputMoney(this)" min="0">
              </div>
              <div class="salary-col">
                  <label class="calc-label">Ng√†y c√¥ng</label>
                  <input type="text" id="ot_soNgayTrongThang" value="30" class="calc-input" inputmode="numeric" onfocus="this.select()" min="0">
              </div>
              <div class="salary-col">
                  <label class="calc-label">Ch·ªß nh·∫≠t</label>
                  <input type="text" id="ot_soNgayChuNhat" value="4" class="calc-input" inputmode="numeric" onfocus="this.select()" min="0">
              </div>
          </div>
          
          <!-- NH·∫¨T K√ù TƒÇNG CA -->
          <div class="section-title" style="margin-top:15px">üóì NH·∫¨T K√ù TƒÇNG CA (GHI S·ªî)</div>
          <div class="log-input-container">
             <div class="log-row-1">
                 <input type="date" id="otLogDate" class="log-input">
             </div>
             <div class="log-row-2">
                 <select id="otLogType" class="log-select">
                     <option value="1.5">TƒÉng ca th∆∞·ªùng</option>
                     <option value="2.0">TƒÉng ca OFF</option>
                 </select>
                 <input type="number" id="otLogHours" class="log-input" placeholder="S·ªë gi·ªù (VD: 8)" inputmode="decimal" onfocus="this.select()" min="0">
             </div>
          </div>
          <button class="calc-submit" id="btnAddOT" onclick="addOTLog()">‚ûï Th√™m Nh·∫≠t K√Ω</button>
          <button class="calc-submit" id="btnCancelOT" onclick="cancelOTEdit()" style="background:#7f8c8d; display:none; margin-top:8px">H·ªßy S·ª≠a</button>

          <table class="log-list" id="otLogList"></table>

          <div class="log-summary">
              <div>TƒÉng ca th∆∞·ªùng: <span id="sum15" class="result-value text-blue">0h</span> - <span id="money15" style="font-weight:bold">0ƒë</span></div>
              <div>TƒÉng ca .....OFF: <span id="sum20" class="result-value text-red">0h</span> - <span id="money20" style="font-weight:bold">0ƒë</span></div>
              <div class="result-item-total">
                  <span>T·ªîNG TI·ªÄN:</span>
                  <span class="big-number" id="sumMoney">0 VNƒê</span>
              </div>
              <div class="ot-note">K·∫øt qu·∫£ t·ª± ƒë·ªông t√≠nh theo L∆∞∆°ng C∆° b·∫£n, H√£y nh·∫≠p ƒë√∫ng s·ªë ng√†y c√¥ng, ng√†y ch·ªß nh·∫≠t c·ªßa th√°ng.<br>K·∫æT QU·∫¢ CH·ªà MANG T√çNH THAM KH·∫¢O.</div>
          </div>
          <button class="save-btn" style="background:#555; width:100%; margin-top:15px; padding:12px" onclick="resetOTMonth()">üóëÔ∏è Qua th√°ng m·ªõi (X√≥a h·∫øt)</button>

          <!-- T√çNH NHANH -->
          <div class="section-title" style="margin-top:25px">‚ö° T√çNH NHANH (D·ª∞ T√çNH)</div>
          <div class="input-group-calc">
              <label class="calc-label">T·ªïng Gi·ªù Th∆∞·ªùng (1.5x):</label>
              <input type="text" id="ot_gioTCTuong" placeholder="Nh·∫≠p gi·ªù..." inputmode="decimal" class="calc-input" onfocus="this.select()" min="0">
          </div>
          <div class="input-group-calc">
              <label class="calc-label">T·ªïng Gi·ªù OFF (2.0x):</label>
              <input type="text" id="ot_gioTCNghi" placeholder="Nh·∫≠p gi·ªù..." inputmode="decimal" class="calc-input" onfocus="this.select()" min="0">
          </div>
          <button onclick="tinhLuong()" class="calc-submit">T√çNH K·∫æT QU·∫¢</button>
          <div class="result-box-ot" id="ketQuaLuong" style="display:none;">
              <h3>üìä K·∫æT QU·∫¢</h3>
              <div class="result-grid-row">
                  <span class="grid-label">L∆∞∆°ng/Gi·ªù:</span>
                  <span class="grid-money" style="grid-column: span 2; text-align:right" id="luongGioCoBan">...</span>
              </div>
              <div class="result-grid-row">
                  <span class="grid-label text-blue">TC Th∆∞·ªùng:</span>
                  <span class="grid-hours text-blue" id="showH15">0h</span>
                  <span class="grid-money text-blue" id="tienTCTuong">0 VNƒê</span>
              </div>
              <div class="result-grid-row">
                  <span class="grid-label text-red">TC OFF:</span>
                  <span class="grid-hours text-red" id="showH20">0h</span>
                  <span class="grid-money text-red" id="tienTCNghi">0 VNƒê</span>
              </div>
              <div class="result-item-total">
                  <span>T·ªîNG C·ªòNG:</span>
                  <span class="big-number" id="tongTienTangCa">0 VNƒê</span>
              </div>
          </div>
      </div>
    </div>
  </div>

  <!-- 7. TI·ªÜN √çCH GOM NH√ìM -->
  <div class="group">
    <div class="group-header" role="button" tabindex="0">
      <span class="title">üß© Ti·ªán √≠ch kh√°c</span><span class="arrow">‚ñ∂</span>
    </div>
    <div class="group-content">
      
      <!-- S·ªî TAY T√ÄI X·∫æ (ƒê∆ØA V√ÄO ƒê√ÇY - TR√äN C√ôNG) -->
      <div class="section-title" style="margin-top:0">üìù S·ªî TAY T√ÄI X·∫æ</div>
      <div class="calc-content" style="padding:0">
        <textarea id="myNote" class="note-area" placeholder="Ghi ch√∫ nhanh: ODO thay nh·ªõt, Ti·ªÅn n·ª£, S·ª± vi·ªác... (L∆∞u tr√™n m√°y)"></textarea>
        <div style="display:flex; justify-content:flex-end; padding:0 10px 10px;">
          <button class="save-btn" onclick="if(confirm('X√≥a h·∫øt ghi ch√∫?')){document.getElementById('myNote').value='';localStorage.removeItem('userNote');}">X√≥a tr·∫Øng</button>
        </div>
      </div>

      <!-- T·∫¢I APP -->
      <div class="section-title">üì± T·∫¢I APP NHI·ªÜM V·ª§ (VnDriver)</div>
      <a class="link-card" href="https://drive.google.com/file/d/1F5Ln5qr86FPn5zybBKha72jKkFyEVwKB/view?usp=drivesdk" target="_blank"><div class="link-left">T·∫£i App Android (APK)</div></a>
      <a class="link-card" href="https://testflight.apple.com/join/ngwb0Mpe" target="_blank"><div class="link-left">T·∫£i App iOS (TestFlight)</div></a>

      <!-- D·ªäCH V·ª§ C√îNG -->
      <div class="section-title">üö¶ D·ªäCH V·ª§ C√îNG TR·ª∞C TUY·∫æN</div>
      <a class="link-card" href="https://www.csgt.vn/tra-cuu-phuong-tien-vi-pham.html" target="_blank"><div class="link-left">üö® Tra c·ª©u Ph·∫°t Ngu·ªôi (C·ª•c CSGT)</div></a>
      <a class="link-card" href="https://dichvucong.gov.vn/p/home/dvc-thanh-toan-vi-pham-giao-thong.html" target="_blank"><div class="link-left">üí∏ N·ªôp ph·∫°t Vi ph·∫°m giao th√¥ng</div></a>
      <a class="link-card" href="https://dvc4.gplx.gov.vn/p/home/dvc-trang-chu.html" target="_blank"><div class="link-left">üÜî ƒê·ªïi Gi·∫•y ph√©p l√°i xe Online</div></a>
    </div>
  </div>
  
    <!-- 8. GI·ªöI THI·ªÜU & H·ªñ TR·ª¢ -->
  <div class="group">
    <div class="group-header" role="button" tabindex="0">
      <span class="title">‚ÑπÔ∏è Gi·ªõi thi·ªáu</span><span class="arrow">‚ñ∂</span>
    </div>
    <div class="group-content">
        <div class="intro-box">
            <b>Link T√†i X·∫ø J&T Express</b> l√† ·ª©ng d·ª•ng web mi·ªÖn ph√≠, ƒë∆∞·ª£c ph√°t tri·ªÉn b·ªüi <b>L√™ T·ªânh</b> nh·∫±m h·ªó tr·ª£ anh em t√†i x·∫ø trong c√¥ng vi·ªác h√†ng ng√†y.
            <br><br>
            <b>C√°c t√≠nh nƒÉng ch√≠nh:</b>
            <ul style="padding-left:20px; margin:5px 0;">
                <li><b>T·ªïng h·ª£p Link & Zalo:</b> Gom t·∫•t c·∫£ c√°c nh√≥m Zalo, link b√°o c√°o, SƒêT ƒëi·ªÅu ph·ªëi v·ªÅ m·ªôt n∆°i, kh√¥ng c·∫ßn t√¨m ki·∫øm.</li>
                <li><b>T√≠nh l∆∞∆°ng tƒÉng ca:</b> T·ª± ƒë·ªông quy ƒë·ªïi gi·ªù ra ti·ªÅn ch√≠nh x√°c.</li>
                <li><b>Nh·∫≠t k√Ω v·∫≠n h√†nh:</b> Ghi ch√©p ODO, t√≠nh ƒë·ªãnh m·ª©c d·∫ßu.</li>
                <li><b>Tra c·ª©u nhanh:</b> Link n·ªôp ph·∫°t, tra c·ª©u ph·∫°t ngu·ªôi...</li>
            </ul>
            ·ª®ng d·ª•ng ho·∫°t ƒë·ªông t·ªët ngay c·∫£ khi <b>kh√¥ng c√≥ m·∫°ng (Offline)</b>.
        </div>
        
        <!-- QR CODE & CHIA S·∫∫ -->
        <div class="qr-container">
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://letinhclover.github.io/jntdriver" alt="QR Code" class="qr-img">
            <br>
            <button class="share-btn-native" onclick="shareApp()">
                üì§ Chia s·∫ª cho ƒë·ªìng ƒë·ªôi
            </button>
        </div>

        <div class="author-box">
            <p>M·ªçi √Ω ki·∫øn ƒë√≥ng g√≥p ho·∫∑c c·∫ßn h·ªó tr·ª£ c√°ch s·ª≠ d·ª•ng,<br>anh em c·ª© nh·∫Øn tin Zalo cho m√¨nh nh√©.</p>
            <a href="https://zalo.me/0708312789" class="contact-btn" style="height:auto; width:fit-content; margin:10px auto; padding:8px 20px;">
                <span style="font-weight:bold; color:var(--blue-text)">üí¨ Nh·∫Øn tin cho L√™ T·ªânh</span>
            </a>
        </div>
    </div>
  </div>

</main>

<footer>
  <div class="footer-text">Trang n√†y ch·ªâ d√†nh cho n·ªôi b·ªô t√†i x·∫ø J&T</div>
  <div class="visitor-count" id="visitCount">ƒêang t·∫£i l∆∞·ª£t truy c·∫≠p...</div>
  <div style="margin-top:4px;">
    ¬© 2025 <a href="https://zalo.me/0708312789" class="footer-link">L√™ T·ªânh</a>
  </div>
</footer>

<script>
// --- SW REGISTRATION (OFFLINE MODE) ---
if ('serviceWorker' in navigator) {
   window.addEventListener('load', () => {
     navigator.serviceWorker.register('sw.js')
       .then(reg => console.log('SW registered!', reg))
       .catch(err => console.log('SW failed', err));
   });
}

// --- H√ÄM L·∫§Y NG√ÄY HI·ªÜN T·∫†I (THEO GI·ªú VI·ªÜT NAM) ---
function setToday(elementId) {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const todayStr = `${year}-${month}-${day}`;
    const el = document.getElementById(elementId);
    if(el) el.value = todayStr;
}

// --- H√ÄM ƒê·ªäNH D·∫†NG TI·ªÄN KHI NH·∫¨P (VD: 5.000.000) ---
function formatInputMoney(el) {
    // 1. L·∫•y gi√° tr·ªã hi·ªán t·∫°i v√† x√≥a h·∫øt k√Ω t·ª± kh√¥ng ph·∫£i s·ªë
    let val = el.value.replace(/\D/g, ''); 
    // 2. N·∫øu r·ªóng th√¨ tho√°t
    if(val === '') { el.value = ''; return; }
    // 3. ƒê·ªãnh d·∫°ng l·∫°i c√≥ d·∫•u ch·∫•m
    el.value = Number(val).toLocaleString('vi-VN');
}

// --- H√ÄM L·∫§Y S·ªê T·ª™ INPUT (X√ìA D·∫§U CH·∫§M TR∆Ø·ªöC KHI T√çNH) ---
function parseMoney(id) {
    let val = document.getElementById(id).value;
    // X√≥a d·∫•u ch·∫•m ph√¢n c√°ch ng√†n, chuy·ªÉn d·∫•u ph·∫©y th·∫≠p ph√¢n th√†nh ch·∫•m (n·∫øu c√≥)
    return parseFloat(val.replace(/\./g, '').replace(/,/g, '.')) || 0;
}

// --- AUTO SAVE SALARY SETTINGS ---
const salaryFields = ['ot_luongCanBan', 'ot_soNgayTrongThang', 'ot_soNgayChuNhat'];

function loadSalarySettings() {
    salaryFields.forEach(id => {
        const saved = localStorage.getItem(id);
        if (saved) {
            const el = document.getElementById(id);
            el.value = saved;
            // N·∫øu l√† √¥ l∆∞∆°ng (c√≥ id ch·ª©a 'luong'), ch·∫°y ƒë·ªãnh d·∫°ng ngay
            if(id === 'ot_luongCanBan') formatInputMoney(el);
        }
    });
}

function saveSalarySettings() {
    salaryFields.forEach(id => {
        const val = document.getElementById(id).value;
        localStorage.setItem(id, val);
    });
    // T·ª± ƒë·ªông t√≠nh l·∫°i ti·ªÅn khi thay ƒë·ªïi th√¥ng s·ªë
    reCalcSalaryAuto();
}

function reCalcSalaryAuto() {
    let h15 = parseFloat(document.getElementById('sum15').innerText) || 0;
    let h20 = parseFloat(document.getElementById('sum20').innerText) || 0;
    calculateOTMoney(h15, h20);
}

// G·∫Øn s·ª± ki·ªán l·∫Øng nghe nh·∫≠p li·ªáu
salaryFields.forEach(id => {
    document.getElementById(id).addEventListener('input', saveSalarySettings);
});

// --- MAPS ---
const googleMapsData = [
    { code: 'GW0', address: 'Kho 1, L√¥ TT1, QL22, KCN T√¢n Ph√∫ Trung, C·ªß Chi', link: 'https://maps.app.goo.gl/8ue4xcmMdxwMS5uX9', type: 'GW' },
    { code: 'GW3', address: '1103 QL1A, B√¨nh Tr·ªã ƒê√¥ng A, B√¨nh T√¢n', link: 'https://maps.app.goo.gl/qdCVdF9DygSqSWin7', type: 'GW' },
    { code: 'GW4', address: 'QL22, T√¢n Ph√∫ Trung, C·ªß Chi (Kho GHTK c≈©)', link: 'https://maps.app.goo.gl/c5A8ZNvydTkjeC7LA', type: 'GW' },
    { code: 'GW5', address: 'L√¥ J, ƒê∆∞·ªùng N6, KCN L√™ Minh Xu√¢n 3, B√¨nh Ch√°nh', link: 'https://maps.app.goo.gl/LZme5LnDZiw1obNU9', type: 'GW' },
    { code: 'GW6', address: 'L√¥ 3D-8, ƒê∆∞·ªùng 12, KCN Long H·∫≠u 3, C·∫ßn Giu·ªôc', link: 'https://maps.app.goo.gl/EZte1BU8pfAkQdUv9', type: 'GW' },
    { code: 'H81', address: '21 ƒê∆∞·ªùng ·ª§ Ghe, Th·ªß ƒê·ª©c', link: 'https://goo.gl/maps/hxigDoxuf2rMm1s78', type: 'HUB' },
    { code: 'H82', address: '17/6A Phan Huy √çch, G√≤ V·∫•p', link: 'https://maps.app.goo.gl/LF6n2nSBkwVmg1h5A', type: 'HUB' },
    { code: 'H83', address: '4 ƒê√†o Tr√≠, KP5, Ph√∫ Thu·∫≠n, Q7', link: 'https://maps.app.goo.gl/7NX3CjqeSju77DRt6', type: 'HUB' },
    { code: 'H85', address: 'S·ªë 9 Th·∫°nh L·ªôc 08, Q12', link: 'https://maps.app.goo.gl/Luaguf3a7NeSFvCs7', type: 'HUB' },
    { code: 'H86', address: '722 √Çu C∆°, T√¢n B√¨nh', link: 'https://maps.app.goo.gl/bbMaJPQytnaeQgNp8', type: 'HUB' },
    { code: 'H87', address: 'Kho SoTrans KM7-9 Xa L·ªô H√† N·ªôi, Th·ªß ƒê·ª©c', link: 'https://maps.app.goo.gl/Eig83EZtiGpY7vgY9', type: 'HUB' },
    { code: 'H89', address: '874/51 T√¢n K·ª≥ T√¢n Qu√Ω, B√¨nh H∆∞ng H√≤a', link: 'https://maps.app.goo.gl/SjSMrEcVJGqnLzo76', type: 'HUB' },
    { code: 'H91', address: '285 N∆° Trang Long, B√¨nh Th·∫°nh', link: 'https://maps.app.goo.gl/uHE7xqVq4bTpQ4C37', type: 'HUB' },
    { code: 'H93', address: '4 ƒê√†o Tr√≠, Q7', link: 'https://maps.app.goo.gl/7NX3CjqeSju77DRt6', type: 'HUB' },
    { code: 'H96', address: 'L√¥ B26, C·ª•m CN Xu√¢n Th·ªõi S∆°n, H√≥c M√¥n', link: 'https://maps.app.goo.gl/om59mKEP1Z1u4PY36', type: 'HUB' },
    { code: 'H98', address: '1185 L√™ ƒê·ª©c Anh, B√¨nh T√¢n', link: 'https://maps.app.goo.gl/543EgfyuHcYiqA12A', type: 'HUB' },
    { code: 'LAZADA', address: '2-4 ƒê∆∞·ªùng M14, B√¨nh H∆∞ng Ho√†, B√¨nh T√¢n', link: 'https://maps.app.goo.gl/eAuwRatRFPKh56at6', type: 'HUB' },
    { code: 'TOPGIA', address: '581 T·ªânh L·ªô 2, Trung L·∫≠p H·∫°, C·ªß Chi', link: 'https://goo.gl/maps/mwE8pJGfhDZqB9Bf8', type: 'HUB' },
];

function generateMapLinks() {
    const container = document.getElementById('mapListContainer');
    if (!container) return;
    const gws = googleMapsData.filter(x => x.type === 'GW');
    const hubs = googleMapsData.filter(x => x.type !== 'GW');
    let html = '';
    html += gws.map(item => `<a class="link-card" href="${item.link}" target="_blank"><div class="link-left"><strong>${item.code}</strong><br><span style="font-size: 0.9em; opacity: 0.8;">${item.address}</span></div><span style="color: var(--primary);">üìç</span></a>`).join('');
    html += `<div style="border-top: 1px dashed #ccc; margin: 10px 15px;"></div>`;
    html += hubs.map(item => `<a class="link-card" href="${item.link}" target="_blank"><div class="link-left"><strong>${item.code}</strong><br><span style="font-size: 0.9em; opacity: 0.8;">${item.address}</span></div><span style="color: var(--primary);">üìç</span></a>`).join('');
    container.innerHTML = html;
}
generateMapLinks();

// --- THEME & ACCORDION ---
const btnTheme = document.getElementById('toggleTheme');
const body = document.body;
function applyTheme(isDark) {
    if (isDark) { body.classList.add('dark'); btnTheme.textContent = '‚òÄÔ∏è'; }
    else { body.classList.remove('dark'); btnTheme.textContent = 'üåô'; }
}
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'dark') applyTheme(true);
else if (savedTheme === 'light') applyTheme(false);
else if (window.matchMedia('(prefers-color-scheme: dark)').matches) applyTheme(true);

btnTheme.onclick = () => {
    const isDark = !body.classList.contains('dark');
    applyTheme(isDark);
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
};

document.querySelectorAll('.group-header').forEach(header => {
    header.addEventListener('click', () => {
        const currentGroup = header.parentElement;
        const isOpen = currentGroup.classList.contains('open');
        document.querySelectorAll('.group').forEach(group => { if (group !== currentGroup) group.classList.remove('open'); });
        if (isOpen) currentGroup.classList.remove('open'); else currentGroup.classList.add('open');
    });
});

// --- S·ªî TAY ---
const noteArea = document.getElementById('myNote');
if(localStorage.getItem('userNote')) noteArea.value = localStorage.getItem('userNote');
noteArea.addEventListener('input', () => localStorage.setItem('userNote', noteArea.value));

// --- HELPER ---
const fmt = (n) => parseFloat(n.toFixed(2));
function evaluateExpression(val) {
    if (!val) return 0;
    let clean = val.toString().replace(/,/g, '.').replace(/[^\d.+-x*]/gi, '').replace(/x/gi, '*');
    try { return Function('"use strict";return (' + clean + ')')() || 0; } catch { return 0; }
}

function formatMoney(n) { return Math.round(n).toLocaleString('vi-VN') + ' VNƒê'; }

async function shareApp() {
    const shareData = { url: 'https://letinhclover.github.io/jntdriver' };
    if (navigator.share) { try { await navigator.share(shareData); } catch (err) { } } else { copyLink(); }
}
function copyLink() {
    const url = "https://letinhclover.github.io/jntdriver";
    var tempInput = document.createElement("input");
    tempInput.value = url; document.body.appendChild(tempInput);
    tempInput.select(); tempInput.setSelectionRange(0, 99999);
    try { document.execCommand("copy"); alert("ƒê√£ sao ch√©p Link!"); } catch (e) { }
    document.body.removeChild(tempInput);
}

fetch("https://api.counterapi.dev/v1/letinhclover.github.io/jntdriver/up")
    .then(res => res.json())
    .then(data => { document.getElementById('visitCount').innerText = "üëÄ L∆∞·ª£t truy c·∫≠p: " + data.count.toLocaleString(); })
    .catch(err => { document.getElementById('visitCount').style.display = "none"; });

// --- T√çNH D·∫¶U ---
window.tinhDau = function() {
  const khoan = parseMoney('khoan'); // D√πng parseMoney ƒë·ªÉ x·ª≠ l√Ω s·ªë c√≥ th·ªÉ c√≥ d·∫•u ch·∫•m
  const km = parseMoney('km');
  const thuc = parseMoney('thuc');
  const gia = parseMoney('gia');
  
  const resultDiv = document.getElementById('resultDau');
  resultDiv.style.display = 'block';

  if(khoan < 0 || km < 0 || thuc < 0 || gia < 0) { alert("S·ªë kh√¥ng ƒë∆∞·ª£c √¢m!"); return; }

  if (km <= 0 || thuc < 0) { resultDiv.innerHTML = '<b style="color:var(--primary);">‚ö†Ô∏è Vui l√≤ng nh·∫≠p Qu√£ng ƒë∆∞·ªùng (>0) v√† D·∫ßu th·ª±c t·∫ø.</b>'; return; }
  const tieuhao = (thuc / km) * 100;
  let html = `<div class="result-item"><span>M·ª©c kho√°n:</span><span class="result-value">${fmt(khoan)} L√≠t</span></div>`;
  html += `<div class="result-item"><span>Qu√£ng ƒë∆∞·ªùng:</span><span class="result-value">${fmt(km)} km</span></div>`;
  if (khoan > 0) {
    const dauKhoan = (km * khoan) / 100;
    const chenhlech = dauKhoan - thuc;
    html += `<div class="result-item"><span>Theo kho√°n:</span><span class="result-value">${fmt(dauKhoan)} L√≠t</span></div>`;
    html += `<div class="result-item"><span>Th·ª±c t·∫ø:</span><span class="result-value">${fmt(thuc)} L√≠t</span></div>`;
    let msgClass = chenhlech >= 0 ? 'color:var(--accent)' : 'color:var(--primary)';
    let msgText = chenhlech >= 0 ? `D∆Ø ${fmt(chenhlech)} L√çT` : `THI·∫æU ${fmt(Math.abs(chenhlech))} L√çT`;
    let moneyText = '';
    if(gia > 0) {
        moneyText = formatMoney(Math.abs(chenhlech * gia));
        if(chenhlech >= 0) moneyText = "(+" + moneyText + ")"; else moneyText = "(-" + moneyText + ")";
    }
    html += `<div class="result-item-total" style="${msgClass}"><span>${msgText}</span><span>${moneyText}</span></div>`;
  } else {
      html += `<div class="result-item"><span>Th·ª±c t·∫ø:</span><span class="result-value">${fmt(thuc)} L√≠t</span></div>`;
      html += `<div class="result-item"><span>Ti√™u hao trung b√¨nh:</span><span class="result-value">${fmt(tieuhao)} L/100km</span></div>`;
  }
  resultDiv.innerHTML = html;
}

// --- NH·∫¨T K√ù D·∫¶U ---
let closingOdo = parseFloat(localStorage.getItem('closingOdo')) || 0;
if(closingOdo > 0) {
    document.getElementById('closingOdo').value = closingOdo;
    document.getElementById('savedOdoText').innerText = "ƒê√£ l∆∞u ODO ch·ªët: " + closingOdo;
}

let fuelLogs = JSON.parse(localStorage.getItem('fuelLogs')) || [];
let editFuelIndex = -1; 

function saveClosingOdo() {
    const val = parseFloat(document.getElementById('closingOdo').value);
    if(!isNaN(val) && val > 0) {
        localStorage.setItem('closingOdo', val);
        closingOdo = val;
        document.getElementById('savedOdoText').innerText = "ƒê√£ l∆∞u ODO ch·ªët: " + val;
        alert("ƒê√£ l∆∞u ODO cu·ªëi th√°ng tr∆∞·ªõc!");
        renderLogs(); 
    }
}

function addFuelLog() {
    if(closingOdo === 0) { alert("Vui l√≤ng l∆∞u 'ODO Ch·ªët' tr∆∞·ªõc!"); return; }
    const date = document.getElementById('logDate').value;
    const liters = parseFloat(document.getElementById('logLiters').value);
    const currentOdo = parseFloat(document.getElementById('logOdo').value);
    
    if(!date || isNaN(liters) || isNaN(currentOdo)) { alert("Nh·∫≠p ƒë·ªß th√¥ng tin!"); return; }
    if(liters < 0 || currentOdo < 0) { alert("S·ªë kh√¥ng ƒë∆∞·ª£c √¢m!"); return; }
    if(currentOdo <= closingOdo) { alert("ODO hi·ªán t·∫°i ph·∫£i l·ªõn h∆°n ODO ch·ªët!"); return; }
    
    if(editFuelIndex > -1) {
        fuelLogs[editFuelIndex] = { date, liters, odo: currentOdo };
        cancelFuelEdit();
    } else {
        fuelLogs.push({ date, liters, odo: currentOdo });
    }
    saveAndRender();
    document.getElementById('logLiters').value = '';
    document.getElementById('logOdo').value = '';
}

function editFuelLog(index) {
    editFuelIndex = index;
    const log = fuelLogs[index];
    document.getElementById('logDate').value = log.date;
    document.getElementById('logLiters').value = log.liters;
    document.getElementById('logOdo').value = log.odo;
    document.getElementById('btnAddFuel').innerText = "üíæ C·∫≠p nh·∫≠t";
    document.getElementById('btnAddFuel').classList.add('btn-update');
    document.getElementById('btnCancelFuel').style.display = "inline-block";
}

function cancelFuelEdit() {
    editFuelIndex = -1;
    document.getElementById('logLiters').value = '';
    document.getElementById('logOdo').value = '';
    document.getElementById('btnAddFuel').innerText = "‚ûï Th√™m Nh·∫≠t K√Ω";
    document.getElementById('btnAddFuel').classList.remove('btn-update');
    document.getElementById('btnCancelFuel').style.display = "none";
}

function deleteLog(index) { if(confirm("X√≥a d√≤ng n√†y?")) { fuelLogs.splice(index, 1); saveAndRender(); } }
function resetFuelMonth() { if(confirm("X√≥a h·∫øt nh·∫≠t k√Ω th√°ng n√†y?")) { fuelLogs = []; saveAndRender(); } }
function saveAndRender() { localStorage.setItem('fuelLogs', JSON.stringify(fuelLogs)); renderLogs(); }

function renderLogs() {
    const list = document.getElementById('fuelLogList');
    list.innerHTML = `<tr><th>Ng√†y</th><th>L√≠t</th><th>ODO</th><th>Km ch·∫°y</th><th>L/100km</th><th></th></tr>`;
    let totalLiters = 0; let totalKm = 0;
    fuelLogs.sort((a, b) => a.odo - b.odo);
    let previousOdo = closingOdo;
    fuelLogs.forEach((log, index) => {
        let dist = log.odo - previousOdo;
        let cons = 0; if(dist > 0) cons = (log.liters / dist) * 100;
        totalLiters += log.liters; totalKm += dist;
        const d = log.date.split('-'); const shortDate = `${d[2]}/${d[1]}`;
        const row = document.createElement('tr');
        row.innerHTML = `<td>${shortDate}</td><td>${log.liters}</td><td>${log.odo}</td><td style="color:var(--primary);font-weight:bold">${dist}</td><td>${cons > 0 ? cons.toFixed(1) : '-'}</td><td><button class="log-action-btn btn-edit" onclick="editFuelLog(${index})">‚úé</button><button class="log-action-btn btn-del" onclick="deleteLog(${index})">√ó</button></td>`;
        list.appendChild(row);
        previousOdo = log.odo;
    });
    document.getElementById('totalLiters').innerText = totalLiters.toFixed(1) + " L√≠t";
    document.getElementById('totalKm').innerText = totalKm + " km";
    let avg = 0; if(totalKm > 0) avg = (totalLiters / totalKm) * 100;
    document.getElementById('avgCons').innerText = avg.toFixed(2);
}

// --- T√çNH L∆Ø∆†NG ---
window.tinhLuong = function() {
    const luongCB = parseMoney('ot_luongCanBan');
    const ngayThang = parseMoney('ot_soNgayTrongThang');
    const ngayCN = parseMoney('ot_soNgayChuNhat');
    
    // Gi·ªù tƒÉng ca c≈©ng c√≥ th·ªÉ nh·∫≠p s·ªë l·∫ª, d√πng parseMoney cho an to√†n
    const gio15 = parseMoney('ot_gioTCTuong');
    const gio20 = parseMoney('ot_gioTCNghi');
    
    document.getElementById('ketQuaLuong').style.display = 'block';
    
    if(luongCB < 0 || ngayThang < 0 || ngayCN < 0 || gio15 < 0 || gio20 < 0) { alert("S·ªë kh√¥ng ƒë∆∞·ª£c √¢m!"); return; }

    if (luongCB <= 0 || ngayThang <= 0) { alert("Nh·∫≠p L∆∞∆°ng CB v√† Ng√†y c√¥ng!"); return; }
    const ngayCongChuan = ngayThang - ngayCN;
    const luongGio = luongCB / (ngayCongChuan * 8);
    const tien15 = gio15 * luongGio * 1.5;
    const tien20 = gio20 * luongGio * 2.0;

    document.getElementById('luongGioCoBan').innerText = formatMoney(luongGio) + "/gi·ªù";
    document.getElementById('showH15').innerText = fmt(gio15); 
    document.getElementById('tienTCTuong').innerText = formatMoney(tien15);
    document.getElementById('showH20').innerText = fmt(gio20); 
    document.getElementById('tienTCNghi').innerText = formatMoney(tien20);
    document.getElementById('tongTienTangCa').innerText = formatMoney(tien15 + tien20);
    
    reCalcSalaryAuto();
}

// --- NH·∫¨T K√ù TƒÇNG CA ---
let otLogs = JSON.parse(localStorage.getItem('otLogs')) || [];
let editOTIndex = -1;

function addOTLog() {
    const date = document.getElementById('otLogDate').value;
    const type = parseFloat(document.getElementById('otLogType').value);
    const hours = parseFloat(document.getElementById('otLogHours').value);
    if(!date || isNaN(hours)) { alert("Nh·∫≠p ƒë·ªß th√¥ng tin!"); return; }
    if(hours < 0) { alert("Gi·ªù kh√¥ng ƒë∆∞·ª£c √¢m!"); return; }
    
    if(editOTIndex > -1) {
        otLogs[editOTIndex] = { date, type, hours };
        cancelOTEdit();
    } else {
        otLogs.push({ date, type, hours });
    }
    saveAndRenderOT();
    document.getElementById('otLogHours').value = '';
}

function editOTLog(index) {
    editOTIndex = index;
    const log = otLogs[index];
    document.getElementById('otLogDate').value = log.date;
    document.getElementById('otLogType').value = log.type;
    document.getElementById('otLogHours').value = log.hours;
    
    document.getElementById('btnAddOT').innerText = "üíæ C·∫≠p nh·∫≠t";
    document.getElementById('btnAddOT').classList.add('btn-update');
    document.getElementById('btnCancelOT').style.display = "inline-block";
}

function cancelOTEdit() {
    editOTIndex = -1;
    document.getElementById('otLogHours').value = '';
    document.getElementById('btnAddOT').innerText = "‚ûï Th√™m Nh·∫≠t K√Ω";
    document.getElementById('btnAddOT').classList.remove('btn-update');
    document.getElementById('btnCancelOT').style.display = "none";
}

function deleteOTLog(index) { if(confirm("X√≥a d√≤ng n√†y?")) { otLogs.splice(index, 1); saveAndRenderOT(); } }
function resetOTMonth() { if(confirm("X√≥a h·∫øt?")) { otLogs = []; saveAndRenderOT(); } }
function saveAndRenderOT() { localStorage.setItem('otLogs', JSON.stringify(otLogs)); renderOTLogs(); }

function renderOTLogs() {
    const list = document.getElementById('otLogList');
    list.innerHTML = `<tr><th>Ng√†y</th><th>Lo·∫°i</th><th>Gi·ªù</th><th></th></tr>`;
    let sum15 = 0; let sum20 = 0;
    
    otLogs.sort((a, b) => new Date(a.date) - new Date(b.date));

    otLogs.forEach((log, index) => {
        if(log.type === 1.5) sum15 += log.hours;
        if(log.type === 2.0) sum20 += log.hours;
        const d = log.date.split('-'); const shortDate = `${d[2]}/${d[1]}`;
        const typeClass = log.type === 1.5 ? 'text-blue' : 'text-red';
        const typeLabel = log.type === 1.5 ? 'TƒÉng ca th∆∞·ªùng' : 'TƒÉng ca OFF';
        
        const row = document.createElement('tr');
        row.innerHTML = `<td>${shortDate}</td><td class="${typeClass}" style="font-weight:bold">${typeLabel}</td><td class="${typeClass}" style="font-weight:bold">${fmt(log.hours)}</td><td><button class="log-action-btn btn-edit" onclick="editOTLog(${index})">‚úé</button><button class="log-action-btn btn-del" onclick="deleteOTLog(${index})">√ó</button></td>`;
        list.appendChild(row);
    });
    document.getElementById('sum15').innerText = fmt(sum15);
    document.getElementById('sum20').innerText = fmt(sum20);
    calculateOTMoney(sum15, sum20);
}

function calculateOTMoney(h15, h20) {
    // D√πng h√†m parseMoney m·ªõi ƒë·ªÉ x·ª≠ l√Ω s·ªë c√≥ d·∫•u ch·∫•m
    const luongCB = parseMoney('ot_luongCanBan');
    const ngayCong = parseMoney('ot_soNgayTrongThang');
    const ngayCN = parseMoney('ot_soNgayChuNhat');
    
    if(luongCB > 0 && ngayCong > 0) {
        const ngayChuan = ngayCong - ngayCN;
        const luongGio = luongCB / (ngayChuan * 8);
        
        const tien15 = h15 * 1.5 * luongGio;
        const tien20 = h20 * 2.0 * luongGio;
        const total = tien15 + tien20;
        
        document.getElementById('money15').innerText = formatMoney(tien15);
        document.getElementById('money20').innerText = formatMoney(tien20);
        document.getElementById('sumMoney').innerText = formatMoney(total);
    }
}

// --- KH·ªûI T·∫†O ·ª®NG D·ª§NG (CH·∫†Y CU·ªêI C√ôNG ƒê·ªÇ ƒê·∫¢M B·∫¢O TH·ª® T·ª∞) ---
function initApp() {
    // 1. L·∫•y ng√†y gi·ªù hi·ªán t·∫°i
    setToday('logDate');
    setToday('otLogDate');

    // 2. T·∫£i c√†i ƒë·∫∑t l∆∞∆°ng TR∆Ø·ªöC (QUAN TR·ªåNG)
    loadSalarySettings();

    // 3. T·∫£i nh·∫≠t k√Ω sau (Khi s·ªë li·ªáu c√†i ƒë·∫∑t ƒë√£ c√≥ trong √¥ input)
    renderLogs();
    renderOTLogs();
}

// G·ªçi h√†m kh·ªüi t·∫°o
initApp();
</script>
</body>
</html>
